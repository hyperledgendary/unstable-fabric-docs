

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create a channel &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="hyperledger-fabricdocs master documentation" href="../index.html"/>
        <link rel="up" title="Creating a channel" href="create_channel_overview.html"/>
        <link rel="next" title="Create a channel using the test network" href="create_channel_test_net.html"/>
        <link rel="prev" title="Creating a channel" href="create_channel_overview.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in Hyperledger Fabric v2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started - Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_run_fabric.html">Getting Started - Run Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developapps/developing_applications.html">Developing Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../test_network.html">Using the Fabric test network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy_chaincode.html">Deploying a smart contract to a channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../write_first_app.html">Running a Fabric Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/commercial_paper.html">Commercial paper tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../private_data_tutorial.html">Using Private Data in Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secured_asset_transfer/secured_private_asset_transfer_tutorial.html">Secured asset transfer in Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../couchdb_tutorial.html">Using CouchDB</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="create_channel_overview.html">Creating a channel</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Create a channel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#folder-structure">Folder structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-one-generate-the-genesis-block-of-the-channel">Step one: Generate the genesis block of the channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-two-use-the-osnadmin-cli-to-add-the-first-orderer-to-the-channel">Step two: Use the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> CLI to add the first orderer to the channel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-three-join-additional-ordering-nodes">Step three: Join additional ordering nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="create_channel_test_net.html">Create a channel using the test network</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_channel_config.html">Using configtx.yaml to build a channel configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="channel_policies.html">Channel policies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../channel_update_tutorial.html">Adding an Org to a Channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_update.html">Updating a channel configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode4ade.html">Writing Your First Chaincode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peer-chaincode-devmode.html">Running chaincode in development mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../videos.html">Videos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_guide_overview.html">Deploying a production network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">Upgrading to the latest release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
          <li><a href="create_channel_overview.html">Creating a channel</a> &raquo;</li>
        
      <li>Create a channel</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/create_channel/create_channel_participation.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="create-a-channel">
<span id="create-a-channel"></span><h1>Create a channel<a class="headerlink" href="#create-a-channel" title="Permalink to this headline">¶</a></h1>
<p>To simplify the channel creation process and enhance the privacy and scalability of channels, it is now possible to create application channels (where transactions involving assets happen) without first creating a “system channel” managed by the ordering service. Use this tutorial to learn how to create new channels without a system channel by using the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool to create a genesis block and the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">CLI</span></code> (which runs against a REST API exposed by each ordering service node) to join ordering nodes to a channel. This process allows ordering nodes to join (or leave) any number of channels as needed, similar to how peers can participate in multiple channels.</p>
<p><strong>How this process differs from the legacy Fabric v2.2 process:</strong></p>
<ul class="simple">
<li><strong>System channel no longer required</strong>: Besides the creation of the system channel representing an extra step (as compared to the new process), this system channel created an extra layer of administration that, for some use cases, provided no tangible benefit.</li>
<li><strong>Consortium no longer required</strong>: You no longer need to define the set of organizations, known as the “consortium”, who are permitted to create channels on a particular ordering service. With this new process, all channels are application channels, so the concept of a list of organizations who can create channels no longer applies. Any set of organizations can get together and create a channel using a defined set of ordering nodes (which become the ordering service of that channel).</li>
<li><strong>Simplified ordering node creation process</strong>: Because a system channel genesis block no longer needs to exist before an ordering node is created, admins can now focus on the process of setting up their infrastructure and making sure their node is working correctly before joining a particular application channel.</li>
</ul>
<p><strong>Benefits of the new process:</strong></p>
<ul class="simple">
<li><strong>Increased privacy</strong>: Because all ordering nodes used to be joined to the system channel, every ordering node in a network knew about the existence of every channel on that ordering service, even if the node itself wasn’t a consenter on that channel and therefore wasn’t ordering or storing its blocks. Now, an ordering node only knows about the channels it is joined to.</li>
<li><strong>Scalability</strong>: When there is a large number of ordering nodes on the system channel, starting the node can take a long time as it has to wait for each orderer to replicate the system channel ledger showing it has joined. Additionally, large numbers of nodes on the system channel increases the number of heartbeat messages being sent between nodes. In large system channels with a large number of nodes, this can cause processing issues, even if no application channels have a large number of ordering nodes on it.</li>
<li><strong>Flexibility</strong>: In the past, the scope of the ordering service was defined by the membership of the node in a system channel, and in some of the application channels created from that particular system channel. Now, orderers can join or leave channels as needed, similar to how peers can join any channel its organization is a member of.</li>
<li><strong>Operational benefits</strong>:<ul>
<li>Easy to list the channels that the ordering node is a consenter on.</li>
<li>Simple process to remove a channel and the blocks associated with that channel.</li>
<li>Orderer nodes can now track channels as a follower before being added to a channel’s consenter set, allowing them to detect this addition more quickly. Previously, this process could take several minutes, causing ordering node admins to restart their nodes so that the node could detect that it was joined more quickly.</li>
<li>If the MSP of a peer organization, as listed in the system channel, needs to be changed, the peer organization no longer needs to coordinate with an admin of the system channel to change the MSP.</li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> The new mode of creating channels is incompatible with creating a channel using a system channel. If the system channel exists, the <code class="docutils literal notranslate"><span class="pre">channel</span> <span class="pre">join</span></code> operation is not supported. Similarly, <code class="docutils literal notranslate"><span class="pre">channel</span> <span class="pre">join</span></code> and <code class="docutils literal notranslate"><span class="pre">channel</span> <span class="pre">remove</span></code> cannot be used with a Solo or Kafka ordering service. “Mixed mode” management, where the system channel is to create channels on some ordering nodes and the new process is used to create channels on other ordering nodes is not supported and highly discouraged. You must either transition to the new process or continue to use the system channel process. For information about removing the system channel from an existing ordering service as part of transitioning to the new process, check out <a class="reference external" href="#remove-the-system-channel">Remove the system channel</a>.</p>
<p>While creating the channel, this tutorial will take you through the following steps and concepts:</p>
<ul class="simple">
<li><a class="reference external" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference external" href="#step-one-generate-the-genesis-block-of-the-channel">Step one: Generate the genesis block of the channel</a></li>
<li><a class="reference external" href="#step-two-use-the-osnadmin-cli-to-add-the-first-orderer-to-the-channel">Step two: Use the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> CLI to add the first orderer to the channel</a></li>
<li><a class="reference external" href="#step-three-join-additional-ordering-nodes">Step three: Join additional ordering nodes</a></li>
<li><a class="reference external" href="#next-steps">Next steps</a></li>
</ul>
<p><strong>Note</strong>: If you prefer to learn how to create a channel with the test network instead, check out the <a class="reference external" href="create_channel_test_net.html">Create a channel using the test network</a> tutorial.</p>
<div class="section" id="folder-structure">
<span id="folder-structure"></span><h2>Folder structure<a class="headerlink" href="#folder-structure" title="Permalink to this headline">¶</a></h2>
<p>This tutorial uses the following folder structure for the generated orderer organization MSP and orderer certificates, and while it is not mandatory, it is useful when referring to the certificates referenced by the commands.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── organizations
│       ├── ordererOrganizations
│       │   └── ordererOrg1.example.com
│       │       ├── msp
│       │       │   ├── cacerts
│       │       │   | └── ca-cert.pem
│       │       │   ├── config.yaml
│       │       │   ├── tlscacerts
│       │       │   | └── tls-ca-cert.pem
│       │       └── ordering-service-nodes
│       │           ├── osn1.ordererOrg1.example.com
│       │           │   ├── msp
│       │           │   │   ├── IssuerPublicKey
│       │           │   │   ├── IssuerRevocationPublicKey
│       │           │   │   ├── cacerts
│       │           │   │   │   └── ca-cert.pem
│       │           │   │   ├── config.yaml
│       │           │   │   ├── keystore
│       │           │   │   │   └── key.pem
│       │           │   │   ├── signcerts
│       │           │   │   │   └── cert.pem
│       │           │   │   └── user
│       │           │   └── tls
│       │           │       ├── IssuerPublicKey
│       │           │       ├── IssuerRevocationPublicKey
│       │           │       ├── cacerts
│       │           │       │   └── tls-ca-cert.pem
│       │           │       ├── keystore
│       │           │       │   └── tls-key.pem
│       │           │       ├── signcerts
│       │           │       │   └── cert.pem
│       │           │       └── user
├── admin-client
│       ├── client-tls-cert.pem
│       ├── client-tls-key.pem
│       └── client-tls-ca-cert.pem
</pre></div>
</div>
<p>There are three sections in the folder structure above to consider:</p>
<ul class="simple">
<li><strong>Orderer organization MSP:</strong> the <code class="docutils literal notranslate"><span class="pre">organizations/ordererOrganizations/ordererOrg1.example.com/msp</span></code>  folder contains the orderer organization MSP that includes the <code class="docutils literal notranslate"><span class="pre">cacerts</span></code> and <code class="docutils literal notranslate"><span class="pre">tlscacerts</span></code> folders that you need to create and then copy in the root certificates (<code class="docutils literal notranslate"><span class="pre">ca-cert.pem</span></code>) for the organization CA and TLS CA respectively. If you are using an intermediate CA, you also need to include the corresponding <code class="docutils literal notranslate"><span class="pre">intermediatecerts</span></code> and <code class="docutils literal notranslate"><span class="pre">tlsintermediatecerts</span></code> folders.</li>
<li><strong>Orderer local MSP:</strong> the <code class="docutils literal notranslate"><span class="pre">organizations/ordererOrganizations/ordererOrg1.example.com/ordering-service-nodes/osn1.ordererOrg1.example.com/msp</span></code> folder, also known as the orderer local MSP, contains the enrollment certificate and private key for the ordering service <code class="docutils literal notranslate"><span class="pre">osn1</span></code> node. This folder is automatically generated when you enroll the orderer identity with a Fabric CA for the organization.</li>
<li><strong>TLS certificates:</strong> the <code class="docutils literal notranslate"><span class="pre">organizations/ordererOrganizations/ordererOrg1.example.com/ordering-service-nodes/osn1.ordererOrg1.example.com/tls</span></code> folder contains the TLS certificate and private key for the ordering service <code class="docutils literal notranslate"><span class="pre">osn1</span></code> node as well as the TLS CA root cert <code class="docutils literal notranslate"><span class="pre">tls-ca-cert.pem</span></code>.</li>
<li><strong>Admin client certificates</strong> - <code class="docutils literal notranslate"><span class="pre">admin-client/</span></code> folder contains the TLS certificates for the admin client that will be issuing the <code class="docutils literal notranslate"><span class="pre">osadmin</span></code> commands. The connection between the admin client that calls the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> CLI and an orderer requires mutual TLS, although it is not required for the network itself. This means the admin client needs to enroll and register with a TLS CA to generate the TLS certificate (<code class="docutils literal notranslate"><span class="pre">client-tls-cert.pem</span></code>) and private key (<code class="docutils literal notranslate"><span class="pre">client-tls-key.pem</span></code>) that is provided to the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> CLI. You will need to copy those certificates and the client TLS CA root cert (<code class="docutils literal notranslate"><span class="pre">client-tls-ca-cert.pem</span></code>) into this folder or point to where they exist on your file system. For simplicity of the tutorial, you could use the same TLS CA that the orderer organization uses. On a production network, they would likely be separate TLS CAs.</li>
</ul>
<p>Certificate names used in this example are for illustration purposes and may not reflect the actual names of the certificates generated by the CA. When you generate the certificates you can rename them accordingly to make it easier to differentiate them.</p>
<p><strong>Important:</strong> You need to create the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file and add it to the organization MSP and local MSP folder for each ordering node. This file enables Node OU support for the MSP, an important feature that allows the MSP’s admin to be identified based on an “admin” OU in an identity’s certificate. Learn more in the <a class="reference external" href="https://hyperledger-fabric-ca.readthedocs.io/en/release-1.4/deployguide/use_CA.html#nodeous">Fabric CA</a> documentation.</p>
<p>If you are using a containerized solution for running your network (which for obvious reasons is a popular choice), <strong>it is a best practice to mount volumes for the certificate directories external to the container where the node itself is running. This will allow the certificates to be used by an ordering node container, regardless whether the ordering node container goes down, becomes corrupted, or is restarted.</strong></p>
</div>
<div class="section" id="prerequisites">
<span id="prerequisites"></span><h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Because <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> commands are performed against an ordering node (which executes the actions), at least one orderer needs to exist so that you can join the orderer to the channel. You can attempt this tutorial with your existing ordering service or deploy a new set of ordering nodes.  If you decide to use <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> commands against orderers in an existing ordering service, the system channel must first be removed from each ordering node before you can create any new channels. Choose whether you want to use your existing ordering service or deploy a new set of orderers:</p>
<ul class="simple">
<li><a class="reference external" href="#use-existing-ordering-service">Use existing ordering service</a></li>
<li><a class="reference external" href="#deploy-a-new-set-of-orderers">Deploy a new set of orderers</a></li>
</ul>
<div class="section" id="use-existing-ordering-service">
<span id="use-existing-ordering-service"></span><h3>Use existing ordering service<a class="headerlink" href="#use-existing-ordering-service" title="Permalink to this headline">¶</a></h3>
<p>Before you can take advantage of this feature on a deployed ordering service, you need to remove the system channel from each ordering node that is a consenter in your application channels. A “mixed mode” of orderers on a channel, where some nodes are part of a system channel and others are not, is not supported. The <code class="docutils literal notranslate"><span class="pre">osadmin</span></code> CLI includes both a <code class="docutils literal notranslate"><span class="pre">channel</span> <span class="pre">list</span></code> and a <code class="docutils literal notranslate"><span class="pre">channel</span> <span class="pre">remove</span></code> command to facilitate the process of removing the system channel. If you prefer to deploy a new ordering service instead, skip ahead to <a class="reference external" href="#deploy-a-new-ordering-service">Deploy a new ordering service</a>.</p>
<div class="section" id="remove-the-system-channel">
<span id="remove-the-system-channel"></span><h4>Remove the system channel<a class="headerlink" href="#remove-the-system-channel" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Before attempting these steps ensure that you have <a class="reference external" href="../upgrade.html">upgraded</a> your ordering nodes to Fabric v2.3 or higher.</p>
</li>
<li><p class="first">Modify the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> for each ordering node to support this feature and restart the node. See the orderer <a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/sampleconfig/orderer.yaml">sampleconfig</a> for more information about these required parameters.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">General.BootstrapMethod</span></code> - Set this value to <code class="docutils literal notranslate"><span class="pre">none</span></code>. Because the system channel is no longer required, the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> file on each orderer needs to be configured with <code class="docutils literal notranslate"><span class="pre">BootstrapMethod:</span> <span class="pre">none</span></code> which means that no bootstrap block is required or used to start up the orderer.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.ListenAddress</span></code> - The orderer admin server address (host and port) that can be used by the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> command to configure channels on the ordering service. This value should be a unique <code class="docutils literal notranslate"><span class="pre">host:port</span></code> combination to avoid conflicts.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.Enabled:</span></code> - Technically this can be set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, but this is not recommended. In general, you should always set this value to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.PrivateKey:</span></code> - The path to and file name of the orderer private key issued by the TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.Certificate:</span></code> - The path to and file name of the orderer signed certificate issued by the TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.ClientAuthRequired:</span></code> This value must be set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. Note that while mutual TLS is required for all operations on the orderer Admin endpoint, the entire network is not required to use Mutual TLS.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.ClientRootCAs:</span></code> - The path to and file name of the admin client TLS CA Root certificate. In the folder structure above, this is <code class="docutils literal notranslate"><span class="pre">admin-client/client-tls-ca-cert.pem</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ChannelParticipation.Enabled:</span></code> - Set this value to <code class="docutils literal notranslate"><span class="pre">true</span></code> to enable this feature on the orderer.</li>
</ul>
</li>
<li><p class="first">Restart each ordering node.</p>
</li>
<li><p class="first">Put the <a class="reference external" href="../kafka_raft_migration.html#entry-to-maintenance-mode">system channel into maintenance mode</a> using the same process for the Kafka to Raft migration. This action stops new channel creation transactions from coming in.</p>
</li>
<li><p class="first">Remove the system channel from the set of orderers, one by one. During the system channel removal from an orderer, the orderer stops servicing all other application channels it is a member of until removal is complete. Therefore, care must be taken to ensure that the remaining orderers can still function and reach consensus. This operation can be staggered, such that depending on the fault tolerance setup of the respective channels, no channel down time is experienced. If an application channel can tolerate one server offline, you should still be able to submit transactions to the channel, via the other orderers that are not undergoing the removal at that time.  Use the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">list</span></code> command to view the channels that this orderer is a member of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export OSN_TLS_CA_ROOT_CERT=../config/organizations/ordererOrganizations/ordererOrg1.example.com/ordering-service-nodes/osn1.ordererOrg1.example.com/tls/cacerts/tls-ca-cert.pem
export ADMIN_TLS_SIGN_CERT=../config/admin-client/client-tls-cert.pem
export ADMIN_TLS_PRIVATE_KEY=../config/admin-client/client-tls-key.pem

osnadmin channel list -o [ORDERER_ADMIN_LISTENADDRESS] --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ORDERER_ADMIN_LISTENADDRESS</span></code> corresponds to the <code class="docutils literal notranslate"><span class="pre">Orderer.Admin.ListenAddress</span></code> defined in the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> for this orderer.</li>
<li><code class="docutils literal notranslate"><span class="pre">OSN_TLS_CA_ROOT_CERT</span></code> with the path and file name of the orderer organization TLS CA root certificate and intermediate certificate if using an intermediate TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">ADMIN_TLS_SIGN_CERT</span></code> with the path and file name of the admin client signed certificate from the TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">ADMIN_TLS_PRIVATE_KEY</span></code> with the path and file name of the admin client private key from the TLS CA.</li>
</ul>
<p><strong>Note:</strong> Because the connection between the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> CLI and the orderer requires mutual TLS, you need to pass the <code class="docutils literal notranslate"><span class="pre">--client-cert</span></code> and <code class="docutils literal notranslate"><span class="pre">--client-key</span></code> parameters on each <code class="docutils literal notranslate"><span class="pre">osadmin</span></code> command. The <code class="docutils literal notranslate"><span class="pre">--client-cert</span></code> parameter points to the admin client certificate and <code class="docutils literal notranslate"><span class="pre">--client-key</span></code> refers to the admin client private key, both issued by the admin client TLS CA.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel list -o HOST1:7081 --ca-file $TLS_CA_ROOT_CERT --client-cert $OSN_TLS_SIGN_CERT --client-key $OSN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>The output of this command looks similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;systemChannel&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;syschannel&quot;</span><span class="p">,</span>
      <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/participation/v1/channels/systemchannel&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;channels&quot;</span><span class="p">:[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;channel1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/participation/v1/channels/channel1&quot;</span>
      <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now you can run <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">remove</span></code> to remove the system channel from the node configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel remove -o [ORDERER_ADMIN_LISTENADDRESS] --channelID syschannel --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel remove -o HOST1:7081 --channelID syschannel --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>When successful you see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Status</span><span class="p">:</span> <span class="mi">204</span>
</pre></div>
</div>
<p>And when you rerun the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">list</span></code> command, you can verify that the system channel was removed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel list -o [ORDERER_ADMIN_LISTENADDRESS] --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>Examine the output of the command to verify that the system channel was removed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;systemChannel&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
  <span class="s2">&quot;channels&quot;</span><span class="p">:[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;channel1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/participation/v1/channels/channel1&quot;</span>
      <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Repeat these commands for each ordering node.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="deploy-a-new-set-of-orderers">
<span id="deploy-a-new-set-of-orderers"></span><h3>Deploy a new set of orderers<a class="headerlink" href="#deploy-a-new-set-of-orderers" title="Permalink to this headline">¶</a></h3>
<p>Use these steps if you prefer to deploy a new set of orderers to try out this feature. Deploying the orderers is a two-step process:</p>
<ul class="simple">
<li><a class="reference external" href="#create-the-ordering-organization-msp-and-generate-ordering-node-certificates">Create the ordering organization MSP and generate ordering node certificates</a></li>
<li><a class="reference external" href="#configure-the-orderer-yaml-file-for-each-orderer">Configure the orderer.yaml file for each orderer</a></li>
</ul>
<div class="section" id="create-the-ordering-organization-msp-and-generate-ordering-node-certificates">
<span id="create-the-ordering-organization-msp-and-generate-ordering-node-certificates"></span><h4>Create the ordering organization MSP and generate ordering node certificates<a class="headerlink" href="#create-the-ordering-organization-msp-and-generate-ordering-node-certificates" title="Permalink to this headline">¶</a></h4>
<p>Before you can deploy an orderer, you need to define the ordering organization MSP definition and generate the TLS and enrollment certificates for each Raft ordering node. To learn how to use a CA to create these identities, check out <a class="reference external" href="https://hyperledger-fabric-ca.readthedocs.io/en/release-1.4/deployguide/use_CA.html">Registering and enrolling identities with a CA</a>. After completing that process, you should have the enrollment and TLS certificates for each node as well as the orderer organization MSP definition. To keep track of the generated certificates and MSP you can use the <a class="reference external" href="#folder-structure">folder structure</a> defined in this topic, although it is not mandatory.</p>
<p>Because this tutorial demonstrates the process for creating a channel with <strong>three orderers</strong> deployed for a single organization, you need to generate enrollment and TLS certificates for each node. Why three orderers? This configuration allows for a majority quorum on the Raft cluster. Namely, when there are three orderers, one at a time can go down for maintenance, while a majority (two of three) is maintained. For more information about the number of nodes you should deploy in production, check out <a class="reference external" href="../orderer/ordering_service.html#raft">The Ordering Service</a>. For simplicity and learning purposes, you have the ability to deploy a single node ordering service, even though such an ordering service will not be highly available and cannot therefore be considered a “production” deployment.</p>
</div>
<div class="section" id="configure-the-orderer-yaml-file-for-each-orderer">
<span id="configure-the-orderer-yaml-file-for-each-orderer"></span><h4>Configure the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> file for each orderer<a class="headerlink" href="#configure-the-orderer-yaml-file-for-each-orderer" title="Permalink to this headline">¶</a></h4>
<p>Follow the instructions in the <a class="reference external" href="../deployorderer/ordererdeploy.html">ordering service deployment guide</a> to build an ordering service with three ordering nodes. Note that when you configure the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> file for each orderer, you will need to make modifications to the <a class="reference external" href="../deployorderer/ordererchecklist.html#channelparticipation"><code class="docutils literal notranslate"><span class="pre">ChannelParticipation</span></code></a> and <a class="reference external" href="../deployorderer/ordererchecklist.html#general-bootstrapmethod"><code class="docutils literal notranslate"><span class="pre">General.BoostrapMethod</span></code></a> parameters to leverage this feature.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">General.BootstrapMethod</span></code> - Set this value to <code class="docutils literal notranslate"><span class="pre">none</span></code>. Because the system channel is no longer required, the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> file on each orderer needs to be configured with <code class="docutils literal notranslate"><span class="pre">BootstrapMethod:</span> <span class="pre">none</span></code> which means that no bootstrap block is required or used to start up the orderer.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.ListenAddress</span></code> - The orderer admin server address (host and port) that can be used by the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> command to configure channels on the ordering service. This value should be a unique <code class="docutils literal notranslate"><span class="pre">host:port</span></code> combination to avoid conflicts.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.Enabled:</span></code> - Technically this can be set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, but this is not recommended. In general, you should always set this value to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.PrivateKey:</span></code> - The path to and file name of the orderer private key issued by the TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.Certificate:</span></code> - The path to and file name of the orderer signed certificate issued by the TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.ClientAuthRequired:</span></code> This value must be set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. Note that while mutual TLS is required for all operations on the orderer Admin endpoint, the entire network is not required to use Mutual TLS.</li>
<li><code class="docutils literal notranslate"><span class="pre">Admin.TLS.ClientRootCAs:</span></code> - The path to and file name of the admin client TLS CA Root certificate. In the folder structure above, this is <code class="docutils literal notranslate"><span class="pre">admin-client/client-tls-ca-cert.pem</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ChannelParticipation.Enabled:</span></code> - Set this value to <code class="docutils literal notranslate"><span class="pre">true</span></code> to enable this feature on the orderer.</li>
</ul>
<p><strong>Start each orderer</strong></p>
<ol>
<li><p class="first">If you have not already, set the path to the location of the Fabric binaries on your system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=&lt;path to download location&gt;/bin:$PATH
</pre></div>
</div>
</li>
<li><p class="first">In your terminal window set the <code class="docutils literal notranslate"><span class="pre">FABRIC_CFG_PATH</span></code> to point to the location of the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> file, relative to where you are running the Fabric commands from. For example, if you download the binaries, and run the commands from the <code class="docutils literal notranslate"><span class="pre">/bin</span></code> directory and the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> is under <code class="docutils literal notranslate"><span class="pre">/config</span></code>, the path would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FABRIC_CFG_PATH</span><span class="o">=../</span><span class="n">config</span>
</pre></div>
</div>
</li>
<li><p class="first">You can now start the orderer by running the following command on each ordering node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">orderer</span> <span class="n">start</span>
</pre></div>
</div>
</li>
</ol>
<p>When the orderer starts successfully, you should see something similar to the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span> <span class="mi">01</span><span class="n">d</span> <span class="n">Registrar</span> <span class="n">initializing</span> <span class="n">without</span> <span class="n">a</span> <span class="n">system</span> <span class="n">channel</span><span class="p">,</span> <span class="n">number</span> <span class="n">of</span> <span class="n">application</span> <span class="n">channels</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="k">with</span> <span class="mi">0</span> <span class="n">consensus</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="n">follower</span><span class="o">.</span><span class="n">Chain</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">INFO</span> <span class="mi">01</span><span class="n">f</span> <span class="n">Starting</span> <span class="n">orderer</span><span class="p">:</span>
</pre></div>
</div>
<p>This action starts the ordering nodes without any channels. Repeat these steps for each orderer. At this point, the three nodes are not communicating with each other until we create a channel in the subsequent steps.</p>
<p>While the ordering node is started, there are no channels on the ordering service yet, we create a channel in the subsequent steps.</p>
</div>
</div>
<div class="section" id="define-your-peer-organizations">
<span id="define-your-peer-organizations"></span><h3>Define your peer organizations<a class="headerlink" href="#define-your-peer-organizations" title="Permalink to this headline">¶</a></h3>
<p>Because the channel you are creating is meant to be used by two or more peer organizations to transact privately on the network, you need to have at least one peer organization defined to act as the channel administrator who can add other organizations. Technically, the peer nodes themselves do not yet have to be deployed, but you do need to create one or more peer organization MSP definitions and at least one peer organization needs to be provided in the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> in the next step. Before proceeding to the next section, follow the steps in the <a class="reference external" href="https://hyperledger-fabric-ca.readthedocs.io/en/release-1.4/deployguide/use_CA.html#create-the-org-msp-needed-to-add-an-org-to-a-channel">Fabric CA</a> documentation to build your peer organization MSP definition. If the peers have been deployed, you should also include their address in the <code class="docutils literal notranslate"><span class="pre">AnchorPeers:</span></code> section.</p>
</div>
</div>
<div class="section" id="step-one-generate-the-genesis-block-of-the-channel">
<span id="step-one-generate-the-genesis-block-of-the-channel"></span><h2>Step one: Generate the genesis block of the channel<a class="headerlink" href="#step-one-generate-the-genesis-block-of-the-channel" title="Permalink to this headline">¶</a></h2>
<p>The process of creating a new channel begins by generating the genesis block for the channel that you will later submit to your orderer in the <code class="docutils literal notranslate"><span class="pre">channel</span> <span class="pre">join</span></code> request. Only one member needs to create the genesis block and it can be shared out of band with the other members on the channel who can inspect it to ensure they agree to the channel configuration and then used by each orderer in the ordering service.</p>
<div class="section" id="set-up-the-configtxgen-tool">
<span id="set-up-the-configtxgen-tool"></span><h3>Set up the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool<a class="headerlink" href="#set-up-the-configtxgen-tool" title="Permalink to this headline">¶</a></h3>
<p>While it is possible to build the channel creation transaction file manually, it is easier to use the <a class="reference external" href="../commands/configtxgen.html">configtxgen</a> tool to build the block by reading a <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file that defines the configuration of your channel.</p>
<p>The  <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool is located in the <code class="docutils literal notranslate"><span class="pre">bin</span></code> folder of downloaded Fabric binaries.</p>
<p>Before using <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code>, confirm you have to set the <code class="docutils literal notranslate"><span class="pre">FABRIC_CFG_PATH</span></code> environment variable to the path of the directory that contains your local copy of the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">FABRIC_CFG_PATH</span><span class="o">=../</span><span class="n">config</span>
</pre></div>
</div>
<p>You can check that you can are able to use the tool by printing the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> help text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">configtxgen</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</div>
<div class="section" id="the-configtx-yaml-file">
<span id="the-configtx-yaml-file"></span><h3>The <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file<a class="headerlink" href="#the-configtx-yaml-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file specifies the <strong>channel configuration</strong> of new channels in a format that is both readable and editable and that can be used by <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code>. The <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool uses the channel profiles that are defined in <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> to create the channel configuration and write it to the <a class="reference external" href="https://developers.google.com/protocol-buffers">protobuf format</a> that can be consumed by Fabric.</p>
<p>A sample <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file is located in the <code class="docutils literal notranslate"><span class="pre">config</span></code> folder of the binary alongside images that you downloaded. The file contains the following configuration sections that we need to create our new channel:</p>
<ul class="simple">
<li><strong><a class="reference external" href="#organizations">Organizations:</a></strong> The organizations that can become members of your channel. Each organization has a reference to the cryptographic material that is used to build the <a class="reference external" href="../membership/membership.html">channel MSP</a>. Exactly which members are part of a channel configuration is defined in the <strong>Profiles</strong> section below.</li>
<li><strong><a class="reference external" href="#orderer">Orderer:</a></strong> Contains the list of ordering nodes that will form the consenter set of the channel.</li>
<li><strong><a class="reference external" href="#profiles">Profiles:</a></strong> Each channel profile references information from other sections of the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file to build a channel configuration. Every channel that is created must reference a profile, which contains information like the peer organizations and the channel’s set of consenters. An unlimited number of profiles can be listed in the <code class="docutils literal notranslate"><span class="pre">Profiles</span></code> section. However, each must have a distinctive name (this will not become the name of the channel itself, as that is specified by a flag given when the channel is created).</li>
</ul>
<p>Refer to the <a class="reference external" href="create_channel_config.html">Using <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> to build a channel configuration</a> tutorial to learn more about this file. However, the following three sections require specific configuration in order to create a channel without a system channel.</p>
<p><strong>Note:</strong> Peer organizations are not required when you initially create the channel, but if you know them it is recommended to add them now to the Profiles <code class="docutils literal notranslate"><span class="pre">Organizations:</span></code> and <code class="docutils literal notranslate"><span class="pre">Applications</span></code> section to avoid having to update the channel configuration later.</p>
<div class="section" id="organizations">
<span id="organizations"></span><h4>Organizations:<a class="headerlink" href="#organizations" title="Permalink to this headline">¶</a></h4>
<p>Provide the orderer organization MSP and any peer organization MSPs that are known. Also provide the endpoint addresses of each ordering node.</p>
<ul class="simple">
<li><strong>Organizations.OrdererEndpoints:</strong></li>
</ul>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OrdererEndpoints</span><span class="p">:</span>
            <span class="o">-</span> <span class="s2">&quot;Host1:7080&quot;</span>
            <span class="o">-</span> <span class="s2">&quot;Host2:7080&quot;</span>
            <span class="o">-</span> <span class="s2">&quot;Host3:7080&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="orderer">
<span id="orderer"></span><h4>Orderer:<a class="headerlink" href="#orderer" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><strong>Orderer.OrdererType</strong> Set this value to <code class="docutils literal notranslate"><span class="pre">etcdraft</span></code>. As mentioned before, this process does not work with Solo or Kafka ordering nodes.</li>
<li><strong>Orderer.EtcdRaft.Consenters</strong> Provide the list of ordering node addresses, in the form of <code class="docutils literal notranslate"><span class="pre">host:port</span></code>, that are considered active members of the consenter set. All orderers that are listed in this section will become active “consenters” on the channel when they join the channel.</li>
</ul>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EtcdRaft</span><span class="p">:</span>
    <span class="n">Consenters</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">Host</span><span class="p">:</span> <span class="n">Host1</span>
          <span class="n">Port</span><span class="p">:</span> <span class="mi">7090</span>
          <span class="n">ClientTLSCert</span><span class="p">:</span> <span class="o">../</span><span class="n">config</span><span class="o">/</span><span class="n">organizations</span><span class="o">/</span><span class="n">ordererOrganizations</span><span class="o">/</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ordering</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">nodes</span><span class="o">/</span><span class="n">osn1</span><span class="o">.</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>
          <span class="n">ServerTLSCert</span><span class="p">:</span> <span class="o">../</span><span class="n">config</span><span class="o">/</span><span class="n">organizations</span><span class="o">/</span><span class="n">ordererOrganizations</span><span class="o">/</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ordering</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">nodes</span><span class="o">/</span><span class="n">osn1</span><span class="o">.</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>
        <span class="o">-</span> <span class="n">Host</span><span class="p">:</span> <span class="n">Host2</span>
          <span class="n">Port</span><span class="p">:</span> <span class="mi">7091</span>
          <span class="n">ClientTLSCert</span><span class="p">:</span> <span class="o">../</span><span class="n">config</span><span class="o">/</span><span class="n">organizations</span><span class="o">/</span><span class="n">ordererOrganizations</span><span class="o">/</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ordering</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">nodes</span><span class="o">/</span><span class="n">osn2</span><span class="o">.</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>
          <span class="n">ServerTLSCert</span><span class="p">:</span> <span class="o">../</span><span class="n">config</span><span class="o">/</span><span class="n">organizations</span><span class="o">/</span><span class="n">ordererOrganizations</span><span class="o">/</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ordering</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">nodes</span><span class="o">/</span><span class="n">osn2</span><span class="o">.</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>
        <span class="o">-</span> <span class="n">Host</span><span class="p">:</span> <span class="n">Host3</span>
          <span class="n">Port</span><span class="p">:</span> <span class="mi">7092</span>
          <span class="n">ClientTLSCert</span><span class="p">:</span> <span class="o">../</span><span class="n">config</span><span class="o">/</span><span class="n">organizations</span><span class="o">/</span><span class="n">ordererOrganizations</span><span class="o">/</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ordering</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">nodes</span><span class="o">/</span><span class="n">osn3</span><span class="o">.</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>
          <span class="n">ServerTLSCert</span><span class="p">:</span> <span class="o">../</span><span class="n">config</span><span class="o">/</span><span class="n">organizations</span><span class="o">/</span><span class="n">ordererOrganizations</span><span class="o">/</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ordering</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">nodes</span><span class="o">/</span><span class="n">osn3</span><span class="o">.</span><span class="n">ordererOrg1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>For simplicity, each orderer in this example is using the same TLS certificate for both the server and client, although this is not required.</p>
<p>When the channel configuration block is created, <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> reads the paths to the TLS certificates and replaces the paths with the corresponding bytes of the certificates.</p>
</div>
<div class="section" id="profiles">
<span id="profiles"></span><h4>Profiles:<a class="headerlink" href="#profiles" title="Permalink to this headline">¶</a></h4>
<p>If you are familiar with the legacy process for creating channels, you will recall that the <code class="docutils literal notranslate"><span class="pre">Profiles:</span></code> section of the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> contained a consortium section under the <code class="docutils literal notranslate"><span class="pre">Orderer:</span></code> group. This consortium definition, which previously specified the peer organizations allowed to create channels on the ordering service, is no longer required. If this section exists in the profile, you cannot use this feature to create a channel. Rather, under the <code class="docutils literal notranslate"><span class="pre">Orderer:</span></code> section you simply include MSP ID of the ordering organization or organizations in the case of a multi-organization ordering service and list the peer organizations in <code class="docutils literal notranslate"><span class="pre">Application:</span></code> section that will be members of the channel. At least one orderer organization and one peer organization must be provided.</p>
<p>The following snippet is an example of a channel profile that contains an orderer configuration based on the default channel, orderer, organization, and policy configurations. The <code class="docutils literal notranslate"><span class="pre">Application:</span></code> section, where the peer organizations are listed, includes the default <code class="docutils literal notranslate"><span class="pre">Application</span></code> settings as well as at least one peer organization (<code class="docutils literal notranslate"><span class="pre">SampleOrg</span></code>, in this example) and the corresponding policies for the channel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Profiles</span><span class="p">:</span>
    <span class="n">SampleAppChannelEtcdRaft</span><span class="p">:</span>
        <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">ChannelDefaults</span>
        <span class="n">Orderer</span><span class="p">:</span>
            <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">OrdererDefaults</span>
            <span class="n">OrdererType</span><span class="p">:</span> <span class="n">etcdraft</span>
            <span class="n">Organizations</span><span class="p">:</span>
                <span class="o">-</span> <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">SampleOrg</span>
                  <span class="n">Policies</span><span class="p">:</span>
                      <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">SampleOrgPolicies</span>
                      <span class="n">Admins</span><span class="p">:</span>
                          <span class="n">Type</span><span class="p">:</span> <span class="n">Signature</span>
                          <span class="n">Rule</span><span class="p">:</span> <span class="s2">&quot;OR(&#39;SampleOrg.member&#39;)&quot;</span>
        <span class="n">Application</span><span class="p">:</span>
            <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">ApplicationDefaults</span>
            <span class="n">Organizations</span><span class="p">:</span>
                <span class="o">-</span> <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">SampleOrg</span>
                  <span class="n">Policies</span><span class="p">:</span>
                      <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">SampleOrgPolicies</span>
                      <span class="n">Admins</span><span class="p">:</span>
                          <span class="n">Type</span><span class="p">:</span> <span class="n">Signature</span>
                          <span class="n">Rule</span><span class="p">:</span> <span class="s2">&quot;OR(&#39;SampleOrg.member&#39;)&quot;</span>
</pre></div>
</div>
<p><strong>Note:</strong> For simplicity, this snippet assumes that the peers and orderers belong to the same organization <code class="docutils literal notranslate"><span class="pre">SampleOrg</span></code>. You can refer to the <a class="reference external" href="https://github.com/hyperledger/fabric/blob/master/sampleconfig/configtx.yaml">sample config</a> for the full example. For a production deployment however, it is recommended that the peer and ordering nodes belong to separate organizations which is why this tutorial uses <code class="docutils literal notranslate"><span class="pre">ordererOrg1.example.com</span></code> for the orderer organization. If you are doing the same, throughout the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> you would need to change all references of the orderer organization from <code class="docutils literal notranslate"><span class="pre">SampleOrg</span></code> to <code class="docutils literal notranslate"><span class="pre">ordererOrg1.example.com</span></code>. This would include adding a new orderer organization <code class="docutils literal notranslate"><span class="pre">ordererOrg1.example.com</span></code> to the <code class="docutils literal notranslate"><span class="pre">Organizations:</span></code> section of the file.</p>
<p>An unlimited number of profiles can be listed in the <code class="docutils literal notranslate"><span class="pre">Profiles</span></code> section according to the needs of your use cases. However, each must have a distinctive name (this will not become the name of the channel itself, as that is specified by a flag given when the channel is created). In the next step, you specify which profile to use when you generate the channel genesis block.</p>
</div>
</div>
<div class="section" id="generate-the-genesis-block">
<span id="generate-the-genesis-block"></span><h3>Generate the genesis block<a class="headerlink" href="#generate-the-genesis-block" title="Permalink to this headline">¶</a></h3>
<p>After you have completed editing the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code>, you can use it to create a new channel for the peer organizations. Every channel configuration starts with a genesis block. Because we previously set the environment variables for the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> tool, you can run the following command to build the genesis block for <code class="docutils literal notranslate"><span class="pre">channel1</span></code> using the <code class="docutils literal notranslate"><span class="pre">SampleAppChannelEtcdRaft</span></code> profile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">configtxgen</span> <span class="o">-</span><span class="n">profile</span> <span class="n">SampleAppGenesisEtcdRaft</span> <span class="o">-</span><span class="n">outputBlock</span> <span class="n">genesis_block</span><span class="o">.</span><span class="n">pb</span> <span class="o">-</span><span class="n">channelID</span> <span class="n">channel1</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-profile</span></code> -  Is the name of the profile in <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> that will be used to create the channel.</li>
<li><code class="docutils literal notranslate"><span class="pre">-outputBlock</span></code> - Is the location of where to store the generated configuration block file.</li>
<li><code class="docutils literal notranslate"><span class="pre">-channelID</span></code> - Is the name of the channel being created. Channel names must be all lower case, less than 250 characters long and match the regular expression <code class="docutils literal notranslate"><span class="pre">[a-z][a-z0-9.-]*</span></code>. The command uses the <code class="docutils literal notranslate"><span class="pre">-profile</span></code> flag to reference the <code class="docutils literal notranslate"><span class="pre">SampleAppGenesisEtcdRaft:</span></code> profile from <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code>.</li>
</ul>
<p>When the command is successful, you will see logs of <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> loading the <code class="docutils literal notranslate"><span class="pre">configtx.yaml</span></code> file and printing a channel creation transaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span> <span class="mi">001</span> <span class="n">Loading</span> <span class="n">configuration</span>
<span class="n">INFO</span> <span class="mi">002</span> <span class="n">orderer</span> <span class="nb">type</span><span class="p">:</span> <span class="n">etcdraft</span>
<span class="n">INFO</span> <span class="mi">003</span> <span class="n">Loaded</span> <span class="n">configuration</span><span class="p">:</span> <span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">configtx</span><span class="o">.</span><span class="n">yaml</span>
<span class="n">INFO</span> <span class="mi">004</span> <span class="n">Generating</span> <span class="n">genesis</span> <span class="n">block</span>
<span class="n">INFO</span> <span class="mi">005</span> <span class="n">Writing</span> <span class="n">genesis</span> <span class="n">block</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-two-use-the-osnadmin-cli-to-add-the-first-orderer-to-the-channel">
<span id="step-two-use-the-osnadmin-cli-to-add-the-first-orderer-to-the-channel"></span><h2>Step two: Use the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> CLI to add the first orderer to the channel<a class="headerlink" href="#step-two-use-the-osnadmin-cli-to-add-the-first-orderer-to-the-channel" title="Permalink to this headline">¶</a></h2>
<p>Now that the genesis block has been created, the first ordering node that receives the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">join</span></code> command command effectively “activates” the channel, though the channel is not fully operational until a quorum of consenters is established (if your profile listed three consenters, at least one more node, for a total of two, would have to join using the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">join</span></code> command).</p>
<p><strong>Note:</strong> If you try to run the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> commands (aside from the <code class="docutils literal notranslate"><span class="pre">channel</span> <span class="pre">list</span></code> command) against an ordering node that is a member of a system channel, you get an error which indicates that the system channel still exists. The system channel needs to be <a class="reference external" href="#remove-the-system-channel">removed</a> before the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> commands can be used to create or join channels.</p>
<p>Each orderer needs to run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export OSN_TLS_CA_ROOT_CERT=../config/organizations/ordererOrganizations/ordererOrg1.example.com/ordering-service-nodes/osn1.ordererOrg1.example.com/tls/cacerts/tls-ca-cert.pem
export ADMIN_TLS_SIGN_CERT=../config/admin-client/client-tls-cert.pem
export ADMIN_TLS_PRIVATE_KEY=../config/admin-client/client-tls-key.pem

osnadmin channel join --channelID [CHANNEL_NAME]  --config-block [CHANNEL_CONFIG_BLOCK] -o [ORDERER_ADMIN_LISTENADDRESS] --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>Replace:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">CHANNEL_NAME</span></code> with the name you want to call this channel.</li>
<li><code class="docutils literal notranslate"><span class="pre">CHANNEL_CONFIG_BLOCK</span></code> with the path and file name of the genesis block you created in Step one if you are creating the channel. Each subsequent ordering node can join the configuration starting with the genesis block, or they can join by providing the latest config block instead.</li>
<li><code class="docutils literal notranslate"><span class="pre">ORDERER_ADMIN_LISTENADDRESS</span></code> corresponds to the <code class="docutils literal notranslate"><span class="pre">Orderer.Admin.ListenAddress</span></code> defined in the <code class="docutils literal notranslate"><span class="pre">orderer.yaml</span></code> for this orderer.</li>
<li><code class="docutils literal notranslate"><span class="pre">OSN_TLS_CA_ROOT_CERT</span></code> with the path and file name of the orderer organization TLS CA root certificate and intermediate certificate if using an intermediate TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">ADMIN_TLS_SIGN_CERT</span></code> with the path and file name of the admin client signed certificate from the TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">ADMIN_TLS_PRIVATE_KEY</span></code> with the path and file name of the admin client private key from the TLS CA.</li>
</ul>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel join --channelID channel1 --config-block genesis_block.pb -o OSN1.example.com:7050 --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p><strong>Note:</strong> Because the connection between the <code class="docutils literal notranslate"><span class="pre">osnadmin</span></code> CLI and the orderer requires mutual TLS, you need to pass the <code class="docutils literal notranslate"><span class="pre">--client-cert</span></code> and <code class="docutils literal notranslate"><span class="pre">--client-key</span></code> parameters on each <code class="docutils literal notranslate"><span class="pre">osadmin</span></code> command. The <code class="docutils literal notranslate"><span class="pre">--client-cert</span></code> parameter points to the admin client certificate and <code class="docutils literal notranslate"><span class="pre">--client-key</span></code> refers to the admin client private key, both issued by the admin client TLS CA.</p>
<p>The output of this command looks similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;participation/v1/channels/channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;consensusRelation&quot;</span><span class="p">:</span> <span class="s2">&quot;consenter&quot;</span><span class="p">,</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
  <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When successful, the orderer is joined to the channel with ledger height <code class="docutils literal notranslate"><span class="pre">1</span></code>. Because this orderer is joining from the genesis block, the <code class="docutils literal notranslate"><span class="pre">status</span></code> is “active”. And because the orderer is part of the channel’s consenter set, its <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> is “consenter”. We delve more into the <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> value in the next section.</p>
<p>You can repeat the same command on the other two orderers. Remember to update the orderer endpoint, <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">[ORDERER_ADMIN_LISTENADDRESS]</span></code>, on the command for the corresponding orderer. Because these two orderers join the channel from the genesis block and are part of the consenter set, their status transitions almost immediately from  “onboarding” to “active” and the “consensusRelation” status is “consenter”. At this point, the channel becomes operational because a majority of consenters (as defined in the channel configuration) are “active”. You should see something similar to the following in your orderer logs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span> <span class="mi">087</span> <span class="n">raft</span><span class="o">.</span><span class="n">node</span><span class="p">:</span> <span class="mi">1</span> <span class="n">elected</span> <span class="n">leader</span> <span class="mi">1</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">2</span> <span class="n">channel</span><span class="o">=</span><span class="n">channel1</span> <span class="n">node</span><span class="o">=</span><span class="mi">1</span>
<span class="n">INFO</span> <span class="mi">088</span> <span class="n">Raft</span> <span class="n">leader</span> <span class="n">changed</span><span class="p">:</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">1</span> <span class="n">channel</span><span class="o">=</span><span class="n">channel1</span> <span class="n">node</span><span class="o">=</span><span class="mi">1</span>
<span class="n">INFO</span> <span class="mi">089</span> <span class="n">Start</span> <span class="n">accepting</span> <span class="n">requests</span> <span class="k">as</span> <span class="n">Raft</span> <span class="n">leader</span> <span class="n">at</span> <span class="n">block</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="n">channel</span><span class="o">=</span><span class="n">channel1</span> <span class="n">node</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>After the first orderer is added to the channel, subsequent nodes can join from either the genesis block or from the latest config block. When an orderer joins from a config block, its status is always “onboarding” while its ledger catches up to the config block that was specified in the join command, after which the status is automatically updated to “active”.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">list</span></code> command with the <code class="docutils literal notranslate"><span class="pre">--channelID</span></code> flag to view the detailed <code class="docutils literal notranslate"><span class="pre">status</span></code> and <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> of any <strong>channel</strong> on any ordering node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel list --channelID [CHANNEL_NAME] -o [ORDERER_ADMIN_LISTENADDRESS] --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel list --channelID channel1 -o HOST2:7081 --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>Replace:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">CHANNEL_NAME</span></code> with the name of the channel specified in the <code class="docutils literal notranslate"><span class="pre">configtxgen</span></code> command when you generated the channel.</li>
<li><code class="docutils literal notranslate"><span class="pre">ORDERER_ADMIN_LISTENADDRESS</span></code> with Orderer.Admin.ListenAddress defined in the orderer.yaml for this orderer.</li>
<li><code class="docutils literal notranslate"><span class="pre">OSN_TLS_CA_ROOT_CERT</span></code> with the path and file name of the orderer organization TLS CA root certificate and intermediate certificate if using an intermediate TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">ADMIN_TLS_SIGN_CERT</span></code> with the path and file name of the admin client signed certificate from the TLS CA.</li>
<li><code class="docutils literal notranslate"><span class="pre">ADMIN_TLS_PRIVATE_KEY</span></code> with the path and file name of the admin client private key from the TLS CA.</li>
</ul>
<p>The output of this command looks similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;participation/v1/channels/channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;consensusRelation&quot;</span><span class="p">:</span> <span class="s2">&quot;consenter&quot;</span><span class="p">,</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
  <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following diagram summarizes the steps you have completed:</p>
<p><img alt="create-channel.osnadmin1-3" src="../_images/osnadmin1-3.png" />
<em>You used the configtxgen command to create the channel genesis block and provided that file when you ran the osnadmin channel join command for each orderer by targeting the admin endpoint on each node.</em></p>
<p>Assuming you have successfully run the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">join</span></code> on all three ordering nodes, you now have an active channel and the ordering service is ready to order transactions into blocks. Peers can join the channel and clients can begin to transact.</p>
<p>If you want to join additional ordering nodes to the consenter set of the channel, following the instructions in the next section.</p>
</div>
<div class="section" id="step-three-join-additional-ordering-nodes">
<span id="step-three-join-additional-ordering-nodes"></span><h2>Step three: Join additional ordering nodes<a class="headerlink" href="#step-three-join-additional-ordering-nodes" title="Permalink to this headline">¶</a></h2>
<p>Over time it may be necessary to add additional ordering nodes to the consenter set of a channel. Other organizations may want to contribute their own orderers to the cluster, or it might prove advantageous under production conditions to permit multiple orderers to go down for maintenance at the same time.</p>
<p>Anytime a new orderer joins the cluster, you need to ensure that you do not lose quorum while the ledger on the new orderer catches up. Adding a fourth orderer to an existing three node cluster changes the majority from two to three. Therefore, during the catch-up process and until the new orderer starts executing consensus, the cluster is in a state of reduced fault tolerance. To account for this situation and avoid any downtime, a command that can ascertain the <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> status of an orderer, which can be either “consenter” or “follower”, has been introduced. When a node joins as a follower, the channel ledger is replicated from other orderers, but as it does not take part in consensus, channel operations are not impacted. Because replicating a long chain of blocks could take a long time, joining as a follower is most useful for channels with high block heights because it allows you to confirm that an orderer is able to replicate blocks before having it count towards quorum. To join an orderer to a channel as a follower, <strong>do not include the node in the channel configuration consenter set</strong>.</p>
<p>To simplify the tutorial, we assume this additional orderer is part of the same organization as the previous three orderers and the orderer organization is already part of the channel configuration. If the organization of the new orderer is not already part of the channel configuration, a channel configuration update that adds the organization must be submitted (and signed by a set of signatures that satisfies the orderer group’s admins policy) before the new orderer can begin pulling blocks. An orderer can pull blocks from other cluster members if its owning organization is defined in the channel configuration, and its orderer signature satisfies the <code class="docutils literal notranslate"><span class="pre">/Channel/Readers</span></code> policy.</p>
<p>For this tutorial, the new orderer is not part of the consenter set. Run the following command to join the new orderer to the channel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>osnadmin channel join --channelID [CHANNEL_NAME]  --config-block [CHANNEL_CONFIG_BLOCK] -o [ORDERER_ADMIN_LISTENADDRESS] --ca-file $OSN_TLS_CA_ROOT_CERT --client-cert $ADMIN_TLS_SIGN_CERT --client-key $ADMIN_TLS_PRIVATE_KEY
</pre></div>
</div>
<p>An orderer can join the channel by providing the genesis block, or the latest config block. But the value of <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> will always be “follower” until this orderer is added to the channel’s consenter set, by submitting an update to the channel configuration.</p>
<p>If <strong>joining from the genesis block</strong>, the output of this command looks similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;participation/v1/channels/channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
  <span class="s2">&quot;consensusRelation&quot;</span><span class="p">:</span> <span class="s2">&quot;follower&quot;</span><span class="p">,</span>
  <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Otherwise, if <strong>joining from the latest config block</strong>, the <code class="docutils literal notranslate"><span class="pre">status</span></code> is <strong>onboarding</strong> until the channel ledger has caught up to the specified config block. You can issue the same <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">list</span></code> command to confirm the status changes to <strong>active</strong> and the ledger height has caught up. For example, if the total number of blocks on the channel ledger at the specified config block was <code class="docutils literal notranslate"><span class="pre">1151</span></code>, after the ledger catches up, the output would look similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;participation/v1/channels/channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
  <span class="s2">&quot;consensusRelation&quot;</span><span class="p">:</span> <span class="s2">&quot;follower&quot;</span><span class="p">,</span>
  <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1151</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, it is important to note that the transition from <strong>onboarding</strong> to <strong>active</strong> should not be the only criteria used to decide whether it is the right time to add the new orderer to the channel’s consenters set. What is more important is the height that the new orderer reached, compared to the height of the consenters. For example, the specified config block may be at height <code class="docutils literal notranslate"><span class="pre">1151</span></code>, but there could be a huge number of normal blocks that follow. After <code class="docutils literal notranslate"><span class="pre">OSN4</span></code> becomes <strong>active</strong> (caught up to the specified config), it is better to compare the height of <code class="docutils literal notranslate"><span class="pre">OSN1</span></code> with that of <code class="docutils literal notranslate"><span class="pre">OSN4</span></code>, and if they are close enough to each other – only then add <code class="docutils literal notranslate"><span class="pre">OSN4</span></code> to the consenters set of the channel.</p>
<p>As a reminder, to pull the blocks to the channel ledger, even as a follower, this new orderer must belong to an organization that is part of the current channel configuration. Otherwise, it is unable to replicate any blocks to its ledger. Also, notice the <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> status is still <strong>follower</strong> because the node is not part of the channel’s consenter set.</p>
<p>The diagram shows the new ordering node that has been added as a follower:</p>
<p><img alt="create-channel.osnadmin4" src="../_images/osnadmin4.png" />
<em>OSN4 is added to the channel as a follower. Its status is “onboarding” while its ledger catches up to the config block provided on the osnadmin channel join command.</em></p>
<p>Although the orderer status transitions from <strong>onboarding</strong> to <strong>active</strong>, it is still unable to participate in the ordering service because its <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> status is <strong>follower</strong>, but it will continue to pull blocks and stay current with the ledger. After the status becomes <strong>active</strong> and you are ready for the orderer to transition from a follower to a consenter, any orderer organization admin can add the orderer to the consenter set on the channel by submitting a <a class="reference external" href="../config_update.html">channel configuration update transaction</a>, or by using the <a class="reference external" href="https://github.com/hyperledger/fabric-config">fabric-config</a> library.</p>
<p><strong>Note:</strong> you should never attempt any configuration changes to the Raft consenters, such as adding a consenter, unless all consenters are online and healthy, as you risk losing quorum and therefore the ability to process transactions.</p>
<p>Ensure that the orderer organization has write privileges in the channel configuration so the orderer can become a consenter. When the channel update transaction is complete, you can use the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">list</span></code> command again to confirm that the <code class="docutils literal notranslate"><span class="pre">consensusRelation</span></code> status for the orderer automatically changes to <strong>consenter</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;participation/v1/channels/channel1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
  <span class="s2">&quot;consensusRelation&quot;</span><span class="p">:</span> <span class="s2">&quot;consenter&quot;</span><span class="p">,</span>
  <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1152</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that if the config block specified on the join command was at a height of <code class="docutils literal notranslate"><span class="pre">1151</span></code>, and there were <code class="docutils literal notranslate"><span class="pre">1000</span></code> other blocks after it, then the config block that adds <code class="docutils literal notranslate"><span class="pre">OSN4</span></code> as a consenter would be at <code class="docutils literal notranslate"><span class="pre">2152</span></code>.</p>
</div>
<div class="section" id="next-steps">
<span id="next-steps"></span><h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="join-peers-to-the-channel">
<span id="join-peers-to-the-channel"></span><h3>Join peers to the channel<a class="headerlink" href="#join-peers-to-the-channel" title="Permalink to this headline">¶</a></h3>
<p>After the channel has been created, you can follow the normal process to join peers to the channel and configure anchor peers.  If the peer organization was not originally included in the channel configuration, you need to submit a <a class="reference external" href="../config_update.html">channel configuration update transaction</a> to add the organization. If it did include the peer organization, then all peer organizations that are members of the channel can fetch the channel genesis block from the ordering service using the <a class="reference external" href="../commands/peerchannel.html#peer-channel-fetch">peer channel fetch</a> command. The organization can then use the genesis block to join the peer to the channel using the <a class="reference external" href="../commands/peerchannel.html#peer-channel-join">peer channel join</a> command. Once the peer is joined to the channel, the peer will build the blockchain ledger by retrieving the other blocks on the channel from the ordering service.</p>
</div>
<div class="section" id="add-or-remove-orderers-from-existing-channels">
<span id="add-or-remove-orderers-from-existing-channels"></span><h3>Add or remove orderers from existing channels<a class="headerlink" href="#add-or-remove-orderers-from-existing-channels" title="Permalink to this headline">¶</a></h3>
<p>You can continue to use the <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">join</span></code> and <code class="docutils literal notranslate"><span class="pre">osnadmin</span> <span class="pre">channel</span> <span class="pre">remove</span></code> commands to add and remove orderers on each channel according to your business needs. Be aware that before you remove a channel from an orderer, it is recommended that you first remove the orderer from the channel’s consenter set by submitting a channel update request.</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="create_channel_test_net.html" class="btn btn-neutral float-right" title="Create a channel using the test network" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_channel_overview.html" class="btn btn-neutral" title="Creating a channel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'master',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>